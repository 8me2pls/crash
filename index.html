<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stackable Embed Generator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #121212; color: #fff; padding: 20px; }
    .embed { background: #1e1e1e; padding: 15px; border-radius: 12px; margin-bottom: 15px; }
    input, textarea { width: 100%; margin: 5px 0; padding: 8px; border-radius: 6px; border: none; }
    button { margin: 5px 0; padding: 10px; border: none; border-radius: 6px; cursor: pointer; }
    .primary { background: #5865f2; color: #fff; }
    .secondary { background: #444; color: #fff; }
    pre { background: #2d2d2d; padding: 10px; border-radius: 6px; margin-top: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Stackable Embed Generator</h1>
  <div id="embeds"></div>
  <button class="secondary" onclick="addEmbed()">+ Add Embed</button>
  <button class="primary" onclick="generateEmbeds()">Generate JSON</button>
  <button class="secondary" onclick="copyLink()">Copy Link</button>
  <button class="secondary" onclick="importEmbed()">Import JSON</button>
  <pre id="output"></pre>

  <script>
    const embedsDiv = document.getElementById("embeds");
    const output = document.getElementById("output");

    function addEmbed(data = {}) {
      const div = document.createElement("div");
      div.className = "embed";
      div.innerHTML = `
        <input type="text" placeholder="Title" value="${data.title || ""}">
        <textarea placeholder="Description">${data.description || ""}</textarea>
        <input type="text" placeholder="Color (#hex)" value="${data.color || ""}">
        <input type="text" placeholder="URL" value="${data.url || ""}">
        <input type="text" placeholder="Footer" value="${data.footer || ""}">
        <input type="text" placeholder="Image URL" value="${data.image || ""}">
        <button class="secondary" onclick="this.parentElement.remove()">Remove</button>
      `;
      embedsDiv.appendChild(div);
    }

    async function generateEmbeds() {
      const embeds = Array.from(embedsDiv.children).map(div => {
        const inputs = div.querySelectorAll("input, textarea");
        return {
          title: inputs[0].value,
          description: inputs[1].value,
          color: inputs[2].value,
          url: inputs[3].value,
          footer: inputs[4].value,
          image: inputs[5].value,
        };
      });

      const res = await fetch("/api/embed", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ embeds }),
      });

      const data = await res.json();
      output.textContent = JSON.stringify(data, null, 2);
      return data;
    }

    async function copyLink() {
      const data = await generateEmbeds();
      const link = `${window.location.origin}?data=${encodeURIComponent(JSON.stringify(data))}`;
      navigator.clipboard.writeText(link);
      alert("Link copied! Paste it anywhere.");
    }

    function importEmbed() {
      const json = prompt("Paste embed JSON here:");
      try {
        const parsed = JSON.parse(json);
        embedsDiv.innerHTML = "";
        if (parsed.embeds) {
          parsed.embeds.forEach(embed => addEmbed({
            title: embed.title,
            description: embed.description,
            color: embed.color ? "#" + embed.color.toString(16) : "",
            url: embed.url,
            footer: embed.footer?.text,
            image: embed.image?.url,
          }));
        }
      } catch {
        alert("Invalid JSON!");
      }
    }

    // Auto-load from ?data=
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has("data")) {
      try {
        const parsed = JSON.parse(decodeURIComponent(urlParams.get("data")));
        if (parsed.embeds) {
          parsed.embeds.forEach(embed => addEmbed({
            title: embed.title,
            description: embed.description,
            color: embed.color ? "#" + embed.color.toString(16) : "",
            url: embed.url,
            footer: embed.footer?.text,
            image: embed.image?.url,
          }));
        }
      } catch {}
    } else {
      addEmbed();
    }
  </script>
</body>
</html>