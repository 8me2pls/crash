<script src="Pine.js"></script>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Minecraft Skin Statue Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body style="font-family:Arial;background:#121212;color:#fff;text-align:center;padding:40px;">
  <h1>üßç Minecraft Skin Statue Generator</h1>
  <p>Upload a skin (.png) ‚Äî generates a datapack that builds a statue with color-matched blocks.</p>
  
  <input type="file" id="skinUpload" accept=".png" />
  <button id="generate">Generate Datapack</button>
  
  <p id="status"></p>
  <a id="downloadLink" style="display:none;color:#0f0;font-weight:bold">‚¨áÔ∏è Download Datapack</a>

  <script>
    const palette = [
      { block: "white_concrete", rgb: [207,213,214] },
      { block: "orange_concrete", rgb: [224,97,1] },
      { block: "magenta_concrete", rgb: [169,48,159] },
      { block: "light_blue_concrete", rgb: [36,137,199] },
      { block: "yellow_concrete", rgb: [241,175,21] },
      { block: "lime_concrete", rgb: [94,168,24] },
      { block: "pink_concrete", rgb: [213,101,142] },
      { block: "gray_concrete", rgb: [54,57,61] },
      { block: "light_gray_concrete", rgb: [125,125,115] },
      { block: "cyan_concrete", rgb: [21,119,136] },
      { block: "purple_concrete", rgb: [100,31,156] },
      { block: "blue_concrete", rgb: [44,46,143] },
      { block: "brown_concrete", rgb: [95,59,32] },
      { block: "green_concrete", rgb: [73,91,36] },
      { block: "red_concrete", rgb: [142,33,33] },
      { block: "black_concrete", rgb: [8,10,15] }
    ];

    function closestBlock(r,g,b) {
      let best = palette[0];
      let bestDist = Infinity;
      for (const p of palette) {
        const [pr,pg,pb] = p.rgb;
        const dist = (r-pr)**2 + (g-pg)**2 + (b-pb)**2;
        if (dist < bestDist) {
          bestDist = dist;
          best = p;
        }
      }
      return best.block;
    }

    const generateBtn = document.getElementById('generate');
    const upload = document.getElementById('skinUpload');
    const link = document.getElementById('downloadLink');
    const status = document.getElementById('status');

    generateBtn.onclick = async () => {
      const file = upload.files[0];
      if (!file) return alert("Upload a .png Minecraft skin first!");
      status.textContent = "Processing skin...";
      const img = new Image();
      img.src = URL.createObjectURL(file);
      await img.decode();

      const canvas = document.createElement("canvas");
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0);

      let mcfunction = "say Building skin statue... \n";
      for (let y = 0; y < img.height; y++) {
        for (let x = 0; x < img.width; x++) {
          const [r,g,b,a] = ctx.getImageData(x, y, 1, 1).data;
          if (a < 128) continue; // skip transparent
          const block = closestBlock(r,g,b);
          mcfunction += `setblock ~${x} ~${-y} ~ ${block}\n`;
        }
      }

      const zip = new JSZip();
      zip.file("pack.mcmeta", JSON.stringify({
        pack: { pack_format: 26, description: "Skin Statue Generator" }
      }, null, 2));
      zip.folder("data/statue/functions").file("create_statue.mcfunction", mcfunction);

      const blob = await zip.generateAsync({ type: "blob" });
      const url = URL.createObjectURL(blob);
      link.href = url;
      link.download = "SkinStatueDatapack.zip";
      link.style.display = "inline";
      link.textContent = "‚¨áÔ∏è Download Datapack";
      status.textContent = "‚úÖ Datapack ready!";
    };
  </script>
</body>
</html>
